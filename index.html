<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title> </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: "Segoe UI", Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #6246ea, #e45858);
            min-height: 100vh;
            color: white;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 30px;
            letter-spacing: 1px;
        }

        #links {
            max-width: 500px;
            margin: auto;
        }

        .link-item {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(6px);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .link-item:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 14px rgba(0,0,0,0.28);
        }

        a {
            font-size: 18px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
        }

        button {
            background: #ffbd59;
            border: none;
            padding: 6px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        button:hover {
            background: #ffe0a0;
            transform: scale(1.07);
        }
    </style>
</head>
<body>

<h1>üìÅ  </h1>

<div id="links"></div>

<script>
/* ------------------------- AES-GCM ENCRYPTION ------------------------- */

async function getKey() {
    const pass = "my-secret-password"; 
    const encoder = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey(
        "raw", encoder.encode(pass), "PBKDF2", false, ["deriveKey"]
    );

    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: encoder.encode("fixed-salt"),
            iterations: 500000,
            hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
    );
}

async function encrypt(text) {
    const key = await getKey();
    const encoder = new TextEncoder();
    const iv = crypto.getRandomValues(new Uint8Array(12));

    const encrypted = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv },
        key,
        encoder.encode(text)
    );

    return { iv: Array.from(iv), data: Array.from(new Uint8Array(encrypted)) };
}

async function decrypt(encObj) {
    const key = await getKey();
    const iv = new Uint8Array(encObj.iv);
    const data = new Uint8Array(encObj.data);

    const decrypted = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv },
        key,
        data
    );

    return new TextDecoder().decode(decrypted);
}

/* ------------------------- INDEXEDDB ------------------------- */

function openDB() {
    return new Promise((resolve, reject) => {
        const req = indexedDB.open("EncryptedLinkDB", 1);

        req.onupgradeneeded = function () {
            req.result.createObjectStore("links");
        };

        req.onsuccess = () => resolve(req.result);
        req.onerror = () => reject(req.error);
    });
}

async function saveLinkName(key, value) {
    const db = await openDB();
    const encrypted = await encrypt(value);
    const tx = db.transaction("links", "readwrite");
    tx.objectStore("links").put(encrypted, key);
}

async function loadLinkName(key) {
    const db = await openDB();
    return new Promise((resolve) => {
        const tx = db.transaction("links", "readonly");
        const req = tx.objectStore("links").get(key);

        req.onsuccess = async () => {
            if (req.result) resolve(await decrypt(req.result));
            else resolve(null);
        };
    });
}

/* ------------------------- UI LOGIC ------------------------- */

const defaultLinks = [
    { id: "p1", name: "Empty 1", url: "pages/page1.html" },
    { id: "p2", name: "Empty 2", url: "pages/page2.html" },
	{ id: "p3", name: "Empty 2", url: "pages/page2.html" },
    { id: "p4", name: "Empty 3", url: "pages/page3.html" }
];

async function loadUI() {
    const container = document.getElementById("links");
    container.innerHTML = "";

    for (let item of defaultLinks) {
        let savedName = await loadLinkName(item.id);
        let displayName = savedName || item.name;

        const div = document.createElement("div");
        div.className = "link-item";

        div.innerHTML = `
            <a id="link_${item.id}" href="${item.url}">${displayName}</a>
            <button onclick="editName('${item.id}')">Edit</button>
        `;

        container.appendChild(div);
    }
}

async function editName(id) {
    const linkElement = document.getElementById("link_" + id);
    const newName = prompt("Enter new link name:", linkElement.textContent);

    if (newName && newName.trim() !== "") {
        linkElement.textContent = newName;
        await saveLinkName(id, newName);
    }
}

loadUI();
</script>

</body>
</html>
